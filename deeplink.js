const DEEPLINK_CONFIG={scheme:"cheekymow://",fallbackUrl:"https://cheekymow.au",timeout:3e3,playStoreUrl:"https://play.google.com/store/apps/details?id=com.companyname.cheekymow"};class DeepLinkHandler{constructor(){this.userAgent=navigator.userAgent||navigator.vendor||window.opera,this.isAndroid=/android/i.test(this.userAgent),this.isIOS=/iPad|iPhone|iPod/.test(this.userAgent)&&!window.MSStream,this.isMobile=this.isAndroid||this.isIOS,this.startTime=Date.now(),this.hasAppOpened=!1,this.init()}init(){const e=this.getRouteFromPath();this.attemptAppOpen(e),this.setupFallbacks(),this.trackDeepLinkAttempt(e)}getRouteFromPath(){const e=window.location.pathname;return e.includes("profile")?"profile":e.includes("upgrade")?"upgrade":""}attemptAppOpen(e){const t=`${DEEPLINK_CONFIG.scheme}${e}`;this.isAndroid?this.tryAndroidAppOpen(t,e):this.isIOS?this.tryIOSAppOpen(t,e):this.showFallback()}tryAndroidAppOpen(e,t){const n=`intent://${t}#Intent;scheme=cheekymow;package=com.companyname.cheekymow;S.browser_fallback_url=${encodeURIComponent(DEEPLINK_CONFIG.playStoreUrl)};end`;this.redirectTo(n),setTimeout((()=>{this.hasAppOpened||this.redirectTo(e)}),100)}tryIOSAppOpen(e,t){this.redirectTo(e)}redirectTo(e){try{window.location.href=e,this.hasAppOpened=!0}catch(t){console.log("Direct redirect failed, trying alternative method");const n=document.createElement("iframe");n.style.display="none",n.src=e,document.body.appendChild(n),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n)}),1e3)}}setupFallbacks(){setTimeout((()=>{this.showFallback()}),DEEPLINK_CONFIG.timeout),document.addEventListener("visibilitychange",(()=>{document.hidden?this.hasAppOpened=!0:document.hidden||this.hasAppOpened||setTimeout((()=>{this.showFallback()}),500)})),window.addEventListener("blur",(()=>{this.hasAppOpened=!0})),window.addEventListener("focus",(()=>{this.hasAppOpened||setTimeout((()=>{this.showFallback()}),300)}))}showFallback(){const e=document.querySelector(".spinner");e&&(e.style.display="none");const t=document.getElementById("fallback-link");t&&(t.style.display="inline-block");const n=document.querySelector("p");n&&(n.textContent="App didn't open? No problem - visit our website instead."),this.trackFallbackShown()}trackDeepLinkAttempt(e){"undefined"!=typeof gtag&&gtag("event","deeplink_attempt",{event_category:"App Integration",event_label:e,transport_type:"beacon"}),console.log(`Attempting to open app with route: ${e}`)}trackFallbackShown(){"undefined"!=typeof gtag&&gtag("event","deeplink_fallback_shown",{event_category:"App Integration",time_elapsed:Date.now()-this.startTime,transport_type:"beacon"}),console.log("Fallback shown after",Date.now()-this.startTime,"ms")}}class AppDetector{static isAppInstalled(e){const t=document.createElement("iframe");t.style.display="none",t.src="cheekymow://ping";const n=setTimeout((()=>{e(!1)}),1e3);t.onload=()=>{clearTimeout(n),e(!0)},document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),2e3)}}document.addEventListener("DOMContentLoaded",(()=>{const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t=new URLSearchParams(window.location.search).has("deeplink");e||t?new DeepLinkHandler:setTimeout((()=>{window.location.href=DEEPLINK_CONFIG.fallbackUrl}),1e3);const n=document.getElementById("fallback-link");n&&n.addEventListener("click",(e=>{e.preventDefault(),window.location.href=DEEPLINK_CONFIG.fallbackUrl}));document.querySelectorAll(".download-btn").forEach((e=>{e.addEventListener("click",(t=>{const n=e.textContent.trim();"undefined"!=typeof gtag&&gtag("event","download_button_click",{event_category:"App Download",event_label:n,transport_type:"beacon"})}))}))})),window.CheekyMowDeepLink={DeepLinkHandler:DeepLinkHandler,AppDetector:AppDetector,config:DEEPLINK_CONFIG};